# Кулинарная книга API
Простое REST API на FastAPI для управления рецептами блюд. Позволяет создавать рецепты, получать список всех рецептов и детальную информацию о конкретном рецепте с автоматическим увеличением счётчика просмотров.

## Возможности

- **POST /recipes** — создание нового рецепта
- **GET /recipes** — получение списка всех рецептов. Сортировка: сначала по популярности (количество просмотров по 
  убыванию), затем по времени приготовления (по возрастанию)
- **GET /recipes/{recipe_id}** — получение детальной информации о рецепте. При каждом запросе счётчик просмотров 
  увеличивается на 1

## Технологический стек

- **FastAPI** — веб-фреймворк
- **SQLAlchemy + asyncio** — работа с базой данных
- **SQLite** (с драйвером aiosqlite) — база данных
- **Pydantic** — валидация и сериализация данных

## Установка и запуск
### Требования
- Python 3.10+

### Установка зависимостей
```
pip install -r requirements.txt
```

### Запуск приложения
```
uvicorn app.main:app --reload
```
Приложение будет доступно по адресу: http://127.0.0.1:8000
Документация API:

- Swagger UI: http://127.0.0.1:8000/docs

### База данных
По умолчанию используется файл ./cookbook.db. При первом запуске таблицы создаются автоматически.

## Примеры запросов
### Создание рецепта
```
curl -X POST "http://127.0.0.1:8000/recipes" \
     -H "Content-Type: application/json" \
     -d '{
           "title": "Паста карбонара",
           "cooking_time": 20,
           "ingredients": ["Спагетти", "Гуанчиале", "Яйца", "Пекорино", "Перец"],
           "description": "Настоящий итальянский рецепт без сливок."
         }'
```
         
### Получение списка рецептов
```
curl http://127.0.0.1:8000/recipes
```

### Получение детали рецепта
```
curl http://127.0.0.1:8000/recipes/1
```

## Тестирование
Проект содержит полный набор асинхронных тестов с использованием:
- pytest
- pytest-asyncio
- httpx
- factory-boy

### Запуск тестов:
```
pytest
```
Тесты покрывают:

- Создание рецепта
- Получение пустого списка
- Обработку 404 при запросе несуществующего рецепта
- Сортировку списка по просмотрам и времени приготовления
- Автоматическое увеличение счётчика просмотров

### Структура проекта
- app/
- `main.py` точка входа FastAPI
- `db.py` настройка БД и dependency
- `models.py` SQLAlchemy модели
- `schemas.py` Pydantic схемы
- `routes.py` эндпоинты API 
- tests/
- `conftest.py` фикстуры для тестов (тестовая БД в памяти)
- `factories.py` фабрики для генерации тестовых данных
- `test_api.py` тесты с фиксированными данными
- `test_with_factory.py` тесты с factory-boy

### Форматирование и линтинг
В проекте настроены:
- black
- isort
- flake8
- mypy
